<div class="widget-card glass-effect" [class]="widgetClass + ' ' + sizeClass">
  <div class="widget-header p-4 border-b border-gray-200">
    <div class="flex justify-between items-center">
      <div class="flex items-center gap-2 text-gray-900 font-medium">
        <svg class="w-5 h-5 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <ng-container [ngSwitch]="widget.type">
            <!-- Weather Icon -->
            <path
              *ngSwitchCase="'weather'"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"
            ></path>
            <!-- Stock/Trending Icon -->
            <path
              *ngSwitchCase="'stock'"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"
            ></path>
            <!-- News/Article Icon -->
            <path
              *ngSwitchCase="'news'"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"
            ></path>
            <!-- Clock Icon -->
            <path
              *ngSwitchCase="'clock'"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
            ></path>
            <!-- Top Stocks/Leaderboard Icon -->
            <path
              *ngSwitchCase="'top_stocks'"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
            ></path>
            <!-- Default Widget Icon -->
            <path
              *ngSwitchDefault
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
            ></path>
          </ng-container>
        </svg>
        <span>{{ widget.title }}</span>
      </div>
      <div class="flex gap-1">
        <!-- Refresh Button -->
        <button
          (click)="onAction({ type: 'refresh' })"
          matTooltip="Refresh data"
          class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 transition-all duration-200"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
            ></path>
          </svg>
        </button>

        <!-- Configure Button -->
        <button
          (click)="onAction({ type: 'configure' })"
          matTooltip="Configure widget"
          class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 transition-all duration-200"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
            ></path>
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
            ></path>
          </svg>
        </button>

        <!-- Fullscreen Button -->
        <button
          (click)="onAction({ type: 'fullscreen' })"
          matTooltip="View fullscreen"
          class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 transition-all duration-200"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"
            ></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <div class="widget-content p-4">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex flex-col items-center gap-3 py-8 text-gray-600">
      <mat-spinner diameter="40" color="primary"></mat-spinner>
      <span>Loading...</span>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="flex flex-col items-center gap-3 py-8 text-red-600">
      <mat-icon>error</mat-icon>
      <span>{{ error }}</span>
    </div>

    <!-- Widget Content -->
    <div *ngIf="!isLoading && !error" class="widget-body">
      <!-- Weather Widget -->
      <div *ngIf="widget.type === 'weather'">
        <ng-container *ngIf="getWeatherData() as weather">
          <div class="flex items-center gap-4 mb-4">
            <div class="weather-icon">
              <img
                *ngIf="weather.current.icon"
                [src]="getWeatherIconUrl(weather.current.icon)"
                [alt]="weather.current.description"
                class="w-16 h-16"
              />
            </div>
            <div class="flex-1">
              <div class="text-3xl font-light mb-1 text-gray-900">
                {{ formatTemperature(weather.current.temperature) }}
              </div>
              <div class="text-gray-700 mb-1">{{ weather.current.description | titlecase }}</div>
              <div class="text-gray-600 text-sm">
                {{ weather.location.name }}, {{ weather.location.country }}
              </div>
            </div>
          </div>

          <div
            *ngIf="widget.config.size !== 'small'"
            class="flex justify-around pt-4 border-t border-gray-200"
          >
            <div class="flex flex-col items-center gap-1 text-sm text-gray-600">
              <svg
                class="w-5 h-5 text-gray-500"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"
                ></path>
              </svg>
              <span>{{ weather.details.humidity }}%</span>
            </div>
            <div class="flex flex-col items-center gap-1 text-sm text-gray-600">
              <svg
                class="w-5 h-5 text-gray-500"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"
                ></path>
              </svg>
              <span>{{ weather.details.wind_speed }} m/s</span>
            </div>
            <div class="flex flex-col items-center gap-1 text-sm text-gray-600">
              <svg
                class="w-5 h-5 text-gray-500"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                ></path>
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                ></path>
              </svg>
              <span>{{ weather.details.visibility }} km</span>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Stock Widget -->
      <div *ngIf="widget.type === 'stock'">
        <ng-container *ngIf="getStockData() as stock">
          <div class="mb-3">
            <div class="text-2xl font-semibold text-primary-600">{{ stock.symbol }}</div>
            <div class="text-gray-600 text-sm">{{ stock.company_name }}</div>
          </div>

          <div class="flex items-baseline gap-3 mb-4">
            <span class="text-3xl font-semibold text-gray-900">{{
              formatCurrency(stock.price.current)
            }}</span>
            <span
              class="text-lg font-medium"
              [class.text-green-600]="stock.change.is_positive"
              [class.text-red-600]="!stock.change.is_positive"
            >
              {{ stock.change.formatted }}
            </span>
          </div>

          <div *ngIf="widget.config.size !== 'small'" class="grid grid-cols-2 gap-2 text-sm">
            <div class="flex justify-between py-1 border-b border-gray-200">
              <span class="text-gray-600">Open:</span>
              <span class="text-gray-900">{{ formatCurrency(stock.price.open) }}</span>
            </div>
            <div class="flex justify-between py-1 border-b border-gray-200">
              <span class="text-gray-600">High:</span>
              <span class="text-gray-900">{{ formatCurrency(stock.range.high) }}</span>
            </div>
            <div class="flex justify-between py-1 border-b border-gray-200">
              <span class="text-gray-600">Low:</span>
              <span class="text-gray-900">{{ formatCurrency(stock.range.low) }}</span>
            </div>
            <div class="flex justify-between py-1 border-b border-gray-200">
              <span class="text-gray-600">Volume:</span>
              <span class="text-gray-900">{{ formatNumber(stock.volume) }}</span>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- News Widget -->
      <div *ngIf="widget.type === 'news'">
        <ng-container *ngIf="getNewsData() as news">
          <div class="flex justify-between items-center mb-4">
            <span class="font-semibold text-primary-600">{{ news.query | titlecase }}</span>
            <span class="px-2 py-1 bg-gray-100 rounded-full text-xs text-gray-600"
              >{{ news.total_results }} articles</span
            >
          </div>

          <div class="space-y-3">
            <div
              *ngFor="let article of news.articles.slice(0, getMaxArticles())"
              class="p-3 bg-gray-50 rounded-lg border border-gray-200"
            >
              <div class="flex justify-between items-start mb-2 gap-2">
                <h4 class="font-medium text-sm leading-tight flex-1 text-gray-900">
                  {{ article.title }}
                </h4>
                <span
                  class="text-xs text-gray-600 bg-gray-200 px-2 py-1 rounded whitespace-nowrap"
                  >{{ article.source }}</span
                >
              </div>
              <p class="text-gray-700 text-sm mb-2 leading-relaxed">{{ article.description }}</p>
              <div class="flex justify-between items-center text-xs text-gray-600">
                <span>{{ formatRelativeTime(article.published_at) }}</span>
                <a
                  [href]="article.url"
                  target="_blank"
                  class="flex items-center gap-1 text-primary-600 hover:text-primary-700 transition-colors"
                >
                  <mat-icon class="text-sm">open_in_new</mat-icon>
                  Read more
                </a>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Clock Widget -->
      <div *ngIf="widget.type === 'clock'" class="text-center">
        <ng-container *ngIf="getClockData() as clock">
          <div class="mb-4">
            <div class="text-4xl font-light font-mono mb-2 text-gray-900">
              {{ clock.time.formatted_12h }}
            </div>
            <div class="text-gray-600 font-medium">{{ clock.location }}</div>
          </div>

          <div *ngIf="widget.config.size !== 'small'" class="pt-4 border-t border-gray-200">
            <div class="text-lg font-medium mb-1 text-gray-900">{{ clock.date.full }}</div>
            <div class="text-gray-600 text-sm">{{ clock.date.day_of_week }}</div>
          </div>
        </ng-container>
      </div>

      <!-- Top Stocks Widget -->
      <div *ngIf="widget.type === 'top_stocks'">
        <ng-container *ngIf="getTopStocksData() as topStocks">
          <div class="flex justify-between items-center mb-4">
            <span class="font-semibold text-primary-600"
              >Top {{ topStocks.total_count }} Stocks</span
            >
            <span class="px-2 py-1 bg-gray-100 rounded-full text-xs text-gray-600"
              >{{ topStocks.market }} Market</span
            >
          </div>
          <div class="space-y-2">
            <div
              *ngFor="let stock of topStocks.stocks"
              class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors"
            >
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center">
                  <span class="text-xs font-bold text-primary-600">{{ stock.rank }}</span>
                </div>
                <div>
                  <div class="font-medium text-sm text-gray-900">{{ stock.symbol }}</div>
                  <div class="text-xs text-gray-600 truncate max-w-24">
                    {{ stock.company_name }}
                  </div>
                </div>
              </div>
              <div class="text-right">
                <div class="font-semibold text-sm text-gray-900">
                  {{ formatCurrency(stock.price.current) }}
                </div>
                <div
                  class="text-xs font-medium"
                  [class.text-green-600]="stock.change.is_positive"
                  [class.text-red-600]="!stock.change.is_positive"
                >
                  {{ stock.change.formatted }}
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="widget.config.size !== 'small'" class="pt-4 border-t border-gray-200 mt-4">
            <div class="grid grid-cols-2 gap-4 text-xs text-gray-600">
              <div class="flex justify-between">
                <span>Sort by:</span>
                <span class="font-medium">{{ topStocks.sort_by | titlecase }}</span>
              </div>
              <div class="flex justify-between">
                <span>Updated:</span>
                <span class="font-medium">{{ formatRelativeTime(topStocks.last_updated) }}</span>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </div>

  <div *ngIf="widget.metadata" class="widget-footer p-3 border-t border-gray-200 bg-gray-50">
    <div class="flex justify-between items-center text-xs text-gray-600">
      <span>{{ formatRelativeTime(widget.metadata.updated_at) }}</span>
      <span *ngIf="isMockData()" class="px-2 py-1 bg-orange-100 text-orange-600 rounded-full"
        >Mock Data</span
      >
    </div>
  </div>
</div>
